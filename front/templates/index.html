{% extends "base.html" %}

{% block content %}
<div class="joke-container">
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ username }}!</h1>
    <p>–ú—ã —Ä–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å –Ω–∞ –Ω–∞—à–µ–º —Å–∞–π—Ç–µ —à—É—Ç–æ–∫! üéâ</p>

    <h2>–°–ª—É—á–∞–π–Ω–∞—è —à—É—Ç–∫–∞</h2>
    {% if random_joke %}
    <div class="joke" id="jokeDisplay">
        {{ random_joke.text }}
        <p class="joke-author">‚Äî {{ random_joke.username }}</p>
    </div>

    <div class="button-container">
        <button class="button" onclick="rateJoke({{ random_joke.id }}, 1)">–ù—Ä–∞–≤–∏—Ç—Å—è ({{ random_joke.likes }})</button>
        <button class="button" onclick="rateJoke({{ random_joke.id }}, -1)">–ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è ({{ random_joke.dislikes }})</button>
        <a href="{{ url_for('welcome') }}"><button class="button">–°–ª–µ–¥—É—é—â–∞—è</button></a>
    </div>
    {% else %}
    <p>–ü–æ–∫–∞ –Ω–µ—Ç —à—É—Ç–æ–∫. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –¥–æ–±–∞–≤–∏—Ç —à—É—Ç–∫—É!</p>
    {% endif %}

    <div class="add-joke-button">
        <a href="{{ url_for('create_joke') }}">
            <button class="button">–î–æ–±–∞–≤–∏—Ç—å —à—É—Ç–∫—É</button>
        </a>
    </div>

    <h2>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —à—É—Ç–∫–∏</h2>
    <ul class="popular-jokes">
        {% for joke in popular_jokes %}
        <li>
            {{ joke.text }}
            <small>(–ª–∞–π–∫–æ–≤: {{ joke.likes }}, –∞–≤—Ç–æ—Ä: {{ joke.username }})</small>
        </li>
        {% endfor %}
    </ul>
</div>

<script>
function rateJoke(jokeId, rating) {
    fetch('/rate_joke', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            joke_id: jokeId,
            rating: rating
        })
    }).then(response => {
        if (response.ok) {
            location.reload();
        }
    });
}
</script>
{% endblock %}